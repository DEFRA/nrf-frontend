sequenceDiagram
    participant User
    participant Browser
    participant LoginCtrl as Login Controller<br/>(auth/controller.js)
    participant YarSession as Yar Session<br/>(session-cache.js)
    participant Cache as Redis/Memory Cache<br/>(session-cache.js)

    %% User-Initiated Sign Out
    User->>Browser: Click "Sign out"
    Browser->>LoginCtrl: GET /auth/sign-out
    LoginCtrl->>YarSession: Get sessionId
    YarSession-->>LoginCtrl: sessionId
    LoginCtrl->>Cache: Delete session by sessionId
    Cache-->>LoginCtrl: Session removed
    LoginCtrl->>YarSession: Clear sessionId cookie
    YarSession-->>LoginCtrl: Cookie cleared
    LoginCtrl->>Browser: 302 Redirect to home

    Note over User,Cache: Alternative: OIDC Sign Out Callback

    %% OIDC Sign Out Callback (when user signs out from Defra ID)
    Browser->>LoginCtrl: GET /auth/sign-out-oidc<br/>(optional callback from Defra ID)
    LoginCtrl->>YarSession: Validate state & clear session
    YarSession-->>LoginCtrl: Session cleared
    LoginCtrl->>Browser: 302 Redirect to home